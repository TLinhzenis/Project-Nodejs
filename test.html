<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω B√†i H√°t</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f4f4f4;
        }
        img {
            width: 50px;
            height: 50px;
            object-fit: cover;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        /* Modal CSS */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; }
        .close { float: right; cursor: pointer; }
    </style>
</head>
<body>

    <h2>üéµ Danh s√°ch b√†i h√°t</h2>
    <button onclick="openAddModal()">‚ûï Th√™m b√†i h√°t</button>
    <table>
        <thead>
            <tr>
                <th>H√¨nh ·∫£nh</th>
                <th>T√™n b√†i h√°t</th>
                <th>Ca sƒ©</th>
                <th>Th·ªÉ lo·∫°i</th>
                <th>Ch·ª©c nƒÉng</th>
            </tr>
        </thead>
        <tbody id="songTable"></tbody>
    </table>

    <!-- Modal Th√™m B√†i H√°t -->
    <div id="addSongModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddModal()">&times;</span>
            <h2>Th√™m b√†i h√°t</h2>
            <label>T√™n b√†i h√°t:</label>
            <input type="text" id="addMusicName">
            <label>Ca sƒ©:</label>
            <input type="text" id="addSinger">
            <label>Th·ªÉ lo·∫°i:</label>
            <input type="text" id="addCategory">
            <label>H√¨nh ·∫£nh:</label>
            <input type="file" id="addImage">
            <label>Audio:</label>
            <input type="file" id="addAudio">
            <button onclick="addSong()">L∆∞u</button>
        </div>
    </div>

    <!-- Modal S·ª≠a B√†i H√°t -->
    <div id="editSongModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>S·ª≠a b√†i h√°t</h2>
            <input type="hidden" id="editSongId">
            <label>T√™n b√†i h√°t:</label>
            <input type="text" id="editMusicName">
            <label>Ca sƒ©:</label>
            <input type="text" id="editSinger">
            <label>Th·ªÉ lo·∫°i:</label>
            <input type="text" id="editCategory">
            <label>H√¨nh ·∫£nh (n·∫øu mu·ªën ƒë·ªïi):</label>
            <input type="file" id="editImage">
            <label>Audio (n·∫øu mu·ªën ƒë·ªïi):</label>
            <input type="file" id="editAudio">
            <button onclick="updateSong()">C·∫≠p nh·∫≠t</button>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:3000/api/songs";

        // üöÄ L·∫•y danh s√°ch b√†i h√°t t·ª´ API
        async function fetchSongs() {
            const res = await fetch(API_URL);
            const songs = await res.json();
            let html = "";
            songs.forEach(song => {
                html += `
                    <tr>
                        <td><img src="./uploads/images/${song.image}" alt="·∫¢nh"></td>
                        <td>${song.musicName}</td>
                        <td>${song.singer}</td>
                        <td>${song.category}</td>
                        <td>
                            <button onclick="openEditModal('${song._id}', '${song.musicName}', '${song.singer}', '${song.category}')">‚úè S·ª≠a</button>
                            <button onclick="deleteSong('${song._id}')">üóë X√≥a</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById("songTable").innerHTML = html;
        }

        // üöÄ M·ªü Modal Th√™m
        function openAddModal() {
            document.getElementById("addSongModal").style.display = "block";
        }

        // üöÄ ƒê√≥ng Modal Th√™m
        function closeAddModal() {
            document.getElementById("addSongModal").style.display = "none";
        }

        // üöÄ Th√™m b√†i h√°t
        async function addSong() {
            let formData = new FormData();
            formData.append("musicName", document.getElementById("addMusicName").value);
            formData.append("singer", document.getElementById("addSinger").value);
            formData.append("category", document.getElementById("addCategory").value);
            formData.append("image", document.getElementById("addImage").files[0]);
            formData.append("audio", document.getElementById("addAudio").files[0]);

            await fetch(API_URL, { method: "POST", body: formData })
                .then(res => res.json())
                .then(() => {
                    closeAddModal();
                    fetchSongs();
                });
        }

        // üöÄ M·ªü Modal S·ª≠a
        function openEditModal(id, name, singer, category) {
            document.getElementById("editSongModal").style.display = "block";
            document.getElementById("editSongId").value = id;
            document.getElementById("editMusicName").value = name;
            document.getElementById("editSinger").value = singer;
            document.getElementById("editCategory").value = category;
        }

        // üöÄ ƒê√≥ng Modal S·ª≠a
        function closeEditModal() {
            document.getElementById("editSongModal").style.display = "none";
        }

        // üöÄ C·∫≠p nh·∫≠t b√†i h√°t
        async function updateSong() {
            let songId = document.getElementById("editSongId").value;
            let formData = new FormData();
            formData.append("musicName", document.getElementById("editMusicName").value);
            formData.append("singer", document.getElementById("editSinger").value);
            formData.append("category", document.getElementById("editCategory").value);

            if (document.getElementById("editImage").files.length > 0) {
                formData.append("image", document.getElementById("editImage").files[0]);
            }
            if (document.getElementById("editAudio").files.length > 0) {
                formData.append("audio", document.getElementById("editAudio").files[0]);
            }

            await fetch(`${API_URL}/${songId}`, { method: "PUT", body: formData })
                .then(res => res.json())
                .then(() => {
                    closeEditModal();
                    fetchSongs();
                });
        }

        // üöÄ X√≥a b√†i h√°t
        async function deleteSong(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i h√°t n√†y?")) {
                await fetch(`${API_URL}/${id}`, { method: "DELETE" });
                fetchSongs();
            }
        }

        // üöÄ Kh·ªüi ch·∫°y khi load trang
        fetchSongs();
    </script>

</body>
</html>
